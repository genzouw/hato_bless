<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>ドライバー操作のトレース</title><meta name="Language" content="ja-jp" /><meta name="System.Keywords" content="トレース" /><meta name="Microsoft.Help.Id" content="723aeae7-6504-4585-ba8b-3525115bea8b" /><meta name="Description" content="Microsoft JDBC Driver for SQL Server をアプリケーションで使用すると、トレース (またはログ記録) を使用して JDBC Driver で発生した問題の解決に役立てることができます。トレースを有効にするため、JDBC Driver では java.util.logging でログ記録 API を使用しています。この API には、Logger および LogRecord オブジェクトを作成するための一連のクラスが用意されています。" /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">ドライバー操作のトレース</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>Microsoft JDBC Driver for SQL Server をアプリケーションで使用すると、トレース (またはログ記録) を使用して JDBC Driver で発生した問題の解決に役立てることができます。トレースを有効にするため、JDBC Driver では java.util.logging でログ記録 API を使用しています。この API には、<b>Logger</b> および <b>LogRecord</b> オブジェクトを作成するための一連のクラスが用意されています。</p><div style="margin: .5em 1.5em .5em 1.5em"><b></b><p>JDBC Driver に含まれているネイティブのコンポーネント sqljdbc_xa.dll については、Built-In Diagnostics (BID) フレームワークを使用してトレースを有効にしています。BID の詳細については、「<a href="http://go.microsoft.com/fwlink/?LinkId=70042">SQL Server 2005 でのデータ アクセスのトレース</a>」を参照してください。</p></div><p>アプリケーションを開発するとき、<b>Logger</b> オブジェクトを呼び出すことができます。このオブジェクトは、<b>LogRecord</b> オブジェクトを順に作成し、作成されたこれらのオブジェクトは <b>Handler</b> オブジェクトに渡されて処理されます。<b>Logger</b> および <b>Handler</b> オブジェクトは、いずれもログ記録のレベルを使用し、どの <b>LogRecords</b> を処理するかを管理することができます。また、オプションでログ記録フィルターを使用することもできます。ログの記録が完了すると、<b>Handler</b> オブジェクトは、<b>Formatter</b> オブジェクトを使用してオプションでログ情報を公開することができます。</p><p>既定では、java.util.logging フレームワークは出力をファイルに書き込みます。この出力ログ ファイルは、JDBC Driver が動作しているコンテキストについて書き込みアクセス許可を持つ必要があります。</p><div style="margin: .5em 1.5em .5em 1.5em"><b></b><p>プログラムをトレースするためのさまざまなログ記録オブジェクトの使用の詳細については、Sun Microsystems の Web サイトで Java ログ記録 API についてのドキュメント (英語ページの可能性があります) を参照してください。</p></div><p>次のセクションでは、ログ記録のレベルおよびログ記録可能なカテゴリについて説明し、アプリケーションでトレースを有効にする方法についての情報を提供します。</p></div><h1 class="heading">ログ記録のレベル</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>作成されるすべてのログ メッセージは、ログ記録のレベルと関連付けられています。ログ記録のレベルはログ メッセージの重要度を決定し、java.util.logging の <span class="label">Level</span> クラスで定義されます。あるレベルでログ記録を有効にすると、それより上のすべてのレベルでログ記録が有効になります。このセクションでは、ログ記録のパブリックなカテゴリと内部的なカテゴリの両方を対象に、ログ記録のレベルについて説明します。ログ記録カテゴリの詳細については、このトピックの「ログ記録のカテゴリ」を参照してください。</p><p>次の表では、パブリックなログ記録のカテゴリで利用可能なログ記録の各レベルについて説明します。</p><div class="tableSection"><table width="50%" cellspacing="2" cellpadding="5" frame="lhs"><tr><th><p>名前</p></th><th><p>説明</p></th></tr><tr><td><p>SEVERE</p></td><td><p>重大なエラーを示す、最高レベルのログ記録です。JDBC Driver では、このレベルはエラーや例外の報告に使用されます。</p></td></tr><tr><td><p>WARNING</p></td><td><p>問題が発生する可能性があることを示します。</p></td></tr><tr><td><p>INFO</p></td><td><p>情報としてのメッセージを提供します。</p></td></tr><tr><td><p>CONFIG</p></td><td><p>構成に関するメッセージを提供します。ただし、現時点では JDBC Driver から構成メッセージは一切提供されません。</p></td></tr><tr><td><p>FINE</p></td><td><p>パブリック メソッドによってスローされるすべての例外を含め、基本的なトレース情報を提供します。</p></td></tr><tr><td><p>FINER</p></td><td><p>パブリック メソッドのすべての開始ポイントと終了ポイント、関連するパラメーターのデータ型、パブリック クラスのすべてのパブリック プロパティなど、詳細なトレース情報を提供します。入力パラメーター、出力パラメーター、メソッドの戻り値 (CLOB、BLOB、NCLOB、Reader、&lt;stream&gt; の戻り値の型を除く) も含まれます。</p></td></tr><tr><td><p>FINEST</p></td><td><p>より詳細なトレース情報を提供します。これは最低レベルのログ記録です。</p></td></tr><tr><td><p>OFF</p></td><td><p>ログ記録をオフにします。</p></td></tr><tr><td><p>ALL</p></td><td><p>すべてのメッセージのログ記録を有効にします。</p></td></tr></table></div><p>次の表では、内部的なログ記録のカテゴリで利用可能なログ記録の各レベルについて説明します。</p><div class="tableSection"><table width="50%" cellspacing="2" cellpadding="5" frame="lhs"><tr><th><p>名前</p></th><th><p>説明</p></th></tr><tr><td><p>SEVERE</p></td><td><p>重大なエラーを示す、最高レベルのログ記録です。JDBC Driver では、このレベルはエラーや例外の報告に使用されます。</p></td></tr><tr><td><p>WARNING</p></td><td><p>問題が発生する可能性があることを示します。</p></td></tr><tr><td><p>INFO</p></td><td><p>情報としてのメッセージを提供します。</p></td></tr><tr><td><p>FINE</p></td><td><p>基本的なオブジェクトの作成と破棄など、各種のトレース情報を提供します。パブリック メソッドによってスローされるすべての例外も含まれます。</p></td></tr><tr><td><p>FINER</p></td><td><p>パブリック メソッドのすべての開始ポイントと終了ポイント、関連するパラメーターのデータ型、パブリック クラスのすべてのパブリック プロパティなど、詳細なトレース情報を提供します。入力パラメーター、出力パラメーター、メソッドの戻り値 (CLOB、BLOB、NCLOB、Reader、&lt;stream&gt; の戻り値の型を除く) も含まれます。</p><p>バージョン 1.2 の JDBC Driver には、<a href="937292a6-1525-423e-a2b2-a18fd34c2893.htm">SQLServerConnection</a>、<a href="ec24963c-8b51-4838-91e9-1fbfa2347451.htm">SQLServerStatement</a>、XA、<a href="097434fd-2b74-411c-a5ed-eba04481dde5.htm">SQLServerDataSource</a> の各ログ記録カテゴリが存在し、いずれも FINE のログ記録レベルが割り当てられていました。これらは、バージョン 2.0 リリース以降で FINER レベルにアップグレードされています。</p></td></tr><tr><td><p>FINEST</p></td><td><p>より詳細なトレース情報を提供します。これは最低レベルのログ記録です。</p><p>バージョン 1.2 の JDBC Driver には、TDS.DATA および TDS.TOKEN というログ記録カテゴリが存在し、いずれも FINEST のログ記録レベルが割り当てられていました。バージョン 2.0 リリース以降でも、ログ記録レベルは FINEST から変更されていません。</p></td></tr><tr><td><p>OFF</p></td><td><p>ログ記録をオフにします。</p></td></tr><tr><td><p>ALL</p></td><td><p>すべてのメッセージのログ記録を有効にします。</p></td></tr></table></div></div><h1 class="heading">ログ記録のカテゴリ</h1><div id="sectionSection1" class="section" name="collapseableSection" style=""><p><b>Logger</b> オブジェクトを作成するときは、どの名前付きエンティティまたはカテゴリからログ情報を取得するのかをそのオブジェクトに知らせる必要があります。JDBC Driver は、パブリックなログ記録のカテゴリとして、次のカテゴリをサポートします。いずれも com.microsoft.sqlserver.jdbc ドライバー パッケージで定義されています。</p><div class="tableSection"><table width="50%" cellspacing="2" cellpadding="5" frame="lhs"><tr><th><p>名前</p></th><th><p>説明</p></th></tr><tr><td><p>Connection</p></td><td><p><a href="937292a6-1525-423e-a2b2-a18fd34c2893.htm">SQLServerConnection</a> クラスのメッセージを記録します。アプリケーションは、ログ記録レベルを FINER として設定できます。</p></td></tr><tr><td><p>Statement</p></td><td><p><a href="ec24963c-8b51-4838-91e9-1fbfa2347451.htm">SQLServerStatement</a> クラスのメッセージを記録します。アプリケーションは、ログ記録レベルを FINER として設定できます。</p></td></tr><tr><td><p>DataSource</p></td><td><p><a href="097434fd-2b74-411c-a5ed-eba04481dde5.htm">SQLServerDataSource</a> クラスのメッセージを記録します。アプリケーションは、ログ記録レベルを FINE として設定できます。</p></td></tr><tr><td><p>ResultSet</p></td><td><p><a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a> クラスのメッセージを記録します。アプリケーションは、ログ記録レベルを FINER として設定できます。</p></td></tr><tr><td><p>Driver</p></td><td><p><a href="fbdceae5-7e7b-4edb-8c33-c701ca6b2d53.htm">SQLServerDriver</a> クラスのメッセージを記録します。アプリケーションは、ログ記録レベルを FINER として設定できます。</p></td></tr></table></div><p>Microsoft JDBC Driver Version 2.0 以降では、さらに com.microsoft.sqlserver.jdbc.internals パッケージが用意されており、内部的なログ記録のカテゴリとして、次のカテゴリがサポートされています。</p><div class="tableSection"><table width="50%" cellspacing="2" cellpadding="5" frame="lhs"><tr><th><p>名前</p></th><th><p>説明</p></th></tr><tr><td><p>AuthenticationJNI</p></td><td><p>Windows 統合認証の問題に関するメッセージをログに記録します (<span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> 接続プロパティが暗黙的または明示的に <span sdata="langKeyword" value="NativeAuthentication"><span class="keyword">NativeAuthentication</span></span> に設定された場合)。</p><p>アプリケーションは、ログ記録レベルを FINEST および FINE として設定できます。</p></td></tr><tr><td><p>SQLServerConnection</p></td><td><p><a href="937292a6-1525-423e-a2b2-a18fd34c2893.htm">SQLServerConnection</a> クラスのメッセージを記録します。アプリケーションは、ログ記録レベルを FINE および FINER として設定できます。</p></td></tr><tr><td><p>SQLServerDataSource</p></td><td><p><a href="097434fd-2b74-411c-a5ed-eba04481dde5.htm">SQLServerDataSource</a>、<a href="b00e5a90-2af7-4d04-8ef8-256183777dcf.htm">SQLServerConnectionPoolDataSource</a>、および <a href="4c87e9d3-904a-4b86-90cc-3684034c86ee.htm">SQLServerPooledConnection</a> クラスのメッセージを記録します。</p><p>アプリケーションは、ログ記録レベルを FINER として設定できます。</p></td></tr><tr><td><p>InputStream</p></td><td><p>java.io.InputStream、java.io.Reader のほか、max 指定子を持つデータ型 (varchar、nvarchar、varbinary など) に関するメッセージを記録します。</p><p>アプリケーションは、ログ記録レベルを FINER として設定できます。</p></td></tr><tr><td><p>SQLServerException</p></td><td><p><a href="af5ef257-7cf6-4db3-b1ee-07d22d82bef1.htm">SQLServerException</a> クラスのメッセージを記録します。アプリケーションは、ログ記録レベルを FINE として設定できます。</p></td></tr><tr><td><p>SQLServerResultSet</p></td><td><p><a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a> クラスのメッセージを記録します。アプリケーションは、ログ記録レベルを FINE、FINER、および FINEST として設定できます。</p></td></tr><tr><td><p>SQLServerStatement</p></td><td><p><a href="ec24963c-8b51-4838-91e9-1fbfa2347451.htm">SQLServerStatement</a> クラスのメッセージを記録します。アプリケーションは、ログ記録レベルを FINE、FINER、および FINEST として設定できます。</p></td></tr><tr><td><p>XA</p></td><td><p><a href="95fc7b07-2498-4a7e-8f7f-ee0d86b598b4.htm">SQLServerXADataSource</a> クラスのすべての XA トランザクションについてメッセージを記録します。アプリケーションは、ログ記録レベルを FINE および FINER として設定できます。</p></td></tr><tr><td><p>KerbAuthentication</p></td><td><p>タイプ 4 Kerberos 認証に関するメッセージをログに記録します (<span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> 接続プロパティが <span sdata="langKeyword" value="JavaKerberos"><span class="keyword">JavaKerberos</span></span> に設定された場合)。アプリケーションは、ログ記録レベルを FINE または FINER として設定できます。</p></td></tr><tr><td><p>TDS.DATA</p></td><td><p>ドライバーと SQL Server の間で交わされる TDS プロトコル レベルのメッセージ交換を含んだメッセージを記録します。送受信される各 TDS パケットの詳細な内容が ASCII および 16 進形式で記録されます。ログイン資格情報 (ユーザー名とパスワード) は記録されません。それ以外のすべてのデータが記録されます。</p><p>このカテゴリは非常に冗長で詳細なメッセージを作成します。ログ記録のレベルを FINEST に設定したときにのみ有効になります。</p></td></tr><tr><td><p>TDS.Channel</p></td><td><p>SQL Server との TCP 通信チャネルのアクションをトレースします。記録されるメッセージには、読み取りや書き込みのほか、ソケットの開閉が含まれます。SQL Server との SSL (Secure Sockets Layer) 接続の確立に関連したメッセージもトレースされます。</p><p>このカテゴリは、ログ記録レベルを FINE、FINER、または FINEST に設定したときにのみ有効になります。</p></td></tr><tr><td><p>TDS.Writer</p></td><td><p>TDS チャネルへの書き込みをトレースします。トレースされるのは書き込みの長さのみです。書き込みの内容がトレースされるわけではありません。このカテゴリでは、アテンション シグナルがサーバーに送信され、ステートメントの実行がキャンセルされた場合にも、問題がトレースされます。</p><p>このカテゴリは、ログ記録レベルを FINEST に設定したときにのみ有効になります。</p></td></tr><tr><td><p>TDS.Reader</p></td><td><p>TDS チャネルからの特定の読み取り操作を FINEST レベルでトレースします。FINEST レベルのトレースは、非常に冗長になる場合があります。WARNING レベルや SEVERE レベルでは、ドライバーが接続を閉じる前に SQL Server から無効な TDS プロトコルを受信した場合にトレースが行われます。</p><p>このカテゴリは、ログ記録レベルを FINER または FINEST に設定したときにのみ有効になります。</p></td></tr><tr><td><p>TDS.Command</p></td><td><p>低レベルの状態遷移や、TDS コマンドの実行に関連したその他の情報 (Transact-SQL ステートメントの実行、ResultSet カーソルのフェッチ、コミットなど) をトレースします。</p><p>このカテゴリは、ログ記録レベルを FINEST に設定したときにのみ有効になります。</p></td></tr><tr><td><p>TDS.TOKEN</p></td><td><p>このカテゴリは、TDS パケット内のトークンのみを記録しますが、TDS.DATA カテゴリほど冗長ではありません。ログ記録レベルを FINEST に設定したときにのみ有効になります。</p><p>FINEST レベルでは、応答で処理される TDS トークンがトレースされます。SEVERE レベルでは、無効な TDS トークンが検出された場合にトレースが実行されます。</p></td></tr><tr><td><p>SQLServerDatabaseMetaData</p></td><td><p><a href="8b8049d0-8c6d-4476-866b-098709f37eec.htm">SQLServerDatabaseMetaData</a> クラスのメッセージを記録します。アプリケーションは、ログ記録レベルを FINE として設定できます。</p></td></tr><tr><td><p>SQLServerResultSetMetaData</p></td><td><p><a href="9a36885f-83f3-44af-85f0-2b849dfd20d4.htm">SQLServerResultSetMetaData</a> クラスのメッセージを記録します。アプリケーションは、ログ記録レベルを FINE として設定できます。</p></td></tr><tr><td><p>SQLServerParameterMetaData</p></td><td><p><a href="546290e0-9411-4a2b-aa36-61251e70e9cf.htm">SQLServerParameterMetaData</a> クラスのメッセージを記録します。アプリケーションは、ログ記録レベルを FINE として設定できます。</p></td></tr><tr><td><p>SQLServerBlob</p></td><td><p><a href="88bd8623-889d-4b5d-99ff-c85b32f3ff5c.htm">SQLServerBlob</a> クラスのメッセージを記録します。アプリケーションは、ログ記録レベルを FINE として設定できます。</p></td></tr><tr><td><p>SQLServerClob</p></td><td><p><a href="24170524-e1ab-4e80-8fd1-6688efacfbde.htm">SQLServerClob</a> クラスのメッセージを記録します。アプリケーションは、ログ記録レベルを FINE として設定できます。</p></td></tr><tr><td><p>SQLServerSQLXML</p></td><td><p>内部的な <b>SQLServerSQLXML</b> クラスのメッセージを記録します。アプリケーションは、ログ記録レベルを FINE として設定できます。</p></td></tr><tr><td><p>SQLServerDriver</p></td><td><p><a href="fbdceae5-7e7b-4edb-8c33-c701ca6b2d53.htm">SQLServerDriver</a> クラスのメッセージを記録します。アプリケーションは、ログ記録レベルを FINE として設定できます。</p></td></tr><tr><td><p>SQLServerNClob</p></td><td><p><a href="3d3883a2-c39c-439f-bbc0-01e73968672b.htm">SQLServerNClob</a> クラスのメッセージを記録します。アプリケーションは、ログ記録レベルを FINE として設定できます。</p></td></tr></table></div></div><h1 class="heading">トレースをプログラムで有効にする</h1><div id="sectionSection2" class="section" name="collapseableSection" style=""><p>トレースは、<b>Logger</b> オブジェクトを作成し、ログ記録するカテゴリを指定することにより、プログラムで有効にすることができます。たとえば、次のコードは SQL ステートメントのログ記録を有効にする方法を示しています。</p><div class="sampleCode"><span codeLanguage="other"><pre>Logger logger = Logger.getLogger("com.microsoft.sqlserver.jdbc.Statement");
logger.setLevel(Level.FINER);</pre></span></div><p>コードの中でログ記録を無効にするには、次のようにします。</p><div class="sampleCode"><span codeLanguage="other"><pre>logger.setLevel(Level.OFF);</pre></span></div><p>利用可能なすべてのカテゴリをログ記録するには、次のようにします。</p><div class="sampleCode"><span codeLanguage="other"><pre>Logger logger = Logger.getLogger("com.microsoft.sqlserver.jdbc");
logger.setLevel(Level.FINE);</pre></span></div><p>特定のカテゴリのログ記録を無効にするには、次のようにします。</p><div class="sampleCode"><span codeLanguage="other"><pre>Logger logger = Logger.getLogger("com.microsoft.sqlserver.jdbc.Statement");
logger.setLevel(Level.OFF);</pre></span></div></div><h1 class="heading">Logging.Properties ファイルを使用してトレースを有効にする</h1><div id="sectionSection3" class="section" name="collapseableSection" style=""><p><span class="code"> logging.properties </span> ファイルを使用してトレースを有効にすることもできます。このファイルは、Java ランタイム環境 (JRE) のインストール ディレクトリ <span class="code"> lib </span> にあります。このファイルを使用すると、トレースが有効になったときに使用されるロガーやハンドラーに既定値を設定することができます。</p><p>次は、<span class="code">logging.properties</span> ファイルで行うことができる設定の一例です。</p><div class="sampleCode"><span codeLanguage="other"><pre># Specify the handler, the handlers will be installed during VM startup.
handlers= java.util.logging.FileHandler
 
# Default global logging level.
.level= OFF

# default file output is in user's home directory.
java.util.logging.FileHandler.pattern = %h/java%u.log
java.util.logging.FileHandler.limit = 5000000
java.util.logging.FileHandler.count = 20
java.util.logging.FileHandler.formatter = java.util.logging.SimpleFormatter
java.util.logging.FileHandler.level = FINEST

# Facility specific properties.
com.microsoft.sqlserver.jdbc.level=FINEST
</pre></span></div><div style="margin: .5em 1.5em .5em 1.5em"><b></b><p>java.util.logging に含まれる <b>LogManager</b> オブジェクトを使用して、<span class="code">logging.properties</span> ファイルでプロパティを設定することができます。</p></div></div><span id="seeAlsoSpan"><h1 class="heading">関連項目</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="723e2680-a0c5-4a7d-a319-1e49e41078cf.htm">JDBC ドライバーで発生した問題の診断</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">このトピックに関する<a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\dフィードバックありがとうございます。開発チームは、皆様からのフィードバックに基づいてドキュメントを改善しています。フィードバックを確認中、内容の確認または解決策に関するご意見をうかがうために電子メールをお送りする場合があります。お客様の電子メール アドレスをそれ以外の目的で使用することはありません。また、確認完了後はお客様の電子メール アドレス情報を削除させていただきます。%0\Aマイクロソフトのプライバシーに関する声明の詳細については、http://privacy.microsoft.com/ja-jp/default.aspx を参照してください。%0\A%0\d','カスタマー フィードバック');">フィードバック</a>を Microsoft にお送りください。</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft.All rights reserved.</a></p></span></div></div></body></html>