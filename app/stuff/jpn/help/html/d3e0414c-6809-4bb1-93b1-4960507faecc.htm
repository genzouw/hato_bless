<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>トランザクションについて</title><meta name="Language" content="ja-jp" /><meta name="System.Keywords" content="トランザクション" /><meta name="Microsoft.Help.Id" content="d3e0414c-6809-4bb1-93b1-4960507faecc" /><meta name="Description" content="トランザクションは、一連の操作を結合した論理的な作業単位です。トランザクションを使用すると、エラーが発生した場合でも、トランザクションの各操作の一貫性と整合性を制御および維持できます。" /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">トランザクションについて</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>トランザクションは、一連の操作を結合した論理的な作業単位です。トランザクションを使用すると、エラーが発生した場合でも、トランザクションの各操作の一貫性と整合性を制御および維持できます。</p><p>Microsoft JDBC Driver for SQL Server を使用すると、トランザクションをローカルにすることも、分散することもできます。トランザクションで分離レベルを使用することもできます。JDBC ドライバーでサポートされる分離レベルの詳細については、「<span sdata="link"><a href="2c41e23a-da6c-4650-b5fc-b5fe53ba65c3.htm">分離レベルについて</a></span>」を参照してください。</p><p>アプリケーションからトランザクションを制御する際には、Transact-SQL ステートメントか、JDBC ドライバーに備わっているメソッドのどちらかを使用します。両方を使用することはできません。同じトランザクションで Transact-SQL ステートメントと JDBC API メソッドの両方を使用した場合、トランザクションを適切なタイミングでコミットできない、突然トランザクションがコミットまたはロールバックされて新しいトランザクションが開始される、"トランザクションを再開できませんでした" という例外が発生するなどの問題が生じる可能性があります。</p></div><h1 class="heading">ローカル トランザクションの使用</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>単一フェーズであり、データベースによって直接処理されるトランザクションは、ローカル トランザクションであると見なされます。JDBC ドライバーは、<a href="937292a6-1525-423e-a2b2-a18fd34c2893.htm">SQLServerConnection</a> クラスの <a href="db1e22d2-e53f-474e-8c99-cb1fff7f491a.htm">setAutoCommit</a>、<a href="c7346165-51bf-4844-b64c-29833c147236.htm">commit</a>、<a href="7adb6772-4047-4d8e-931d-b3d20eec44b5.htm">rollback</a> などのさまざまなメソッドを使用して、ローカル トランザクションをサポートします。通常、ローカル トランザクションはアプリケーションによって明示的に管理されるか、Java Platform, Enterprise Edition (Java EE) アプリケーション サーバーによって自動的に管理されます。</p><p>次の例では、<span class="code">try</span> ブロック内の 2 つの個別のステートメントで構成されるローカル トランザクションを実行しています。ステートメントは、AdventureWorks SQL Server 2005 サンプル データベースの Production.ScrapReason テーブルに対して実行され、例外がスローされない場合にコミットされます。<span class="code">catch</span> ブロック内のコードは、例外がスローされた場合にトランザクションをロールバックします。</p><div name="snippetGroup"><div class="sampleCode"><span codeLanguage="Java"><pre>public static void executeTransaction(Connection con) {
   try {
      //Switch to manual transaction mode by setting
      //autocommit to false. Note that this starts the first 
      //manual transaction.
      con.setAutoCommit(false);
      Statement stmt = con.createStatement();
      stmt.executeUpdate("INSERT INTO Production.ScrapReason(Name) VALUES('Wrong size')");
      stmt.executeUpdate("INSERT INTO Production.ScrapReason(Name) VALUES('Wrong color')");
      con.commit(); //This commits the transaction and starts a new one.
      stmt.close(); //This turns off the transaction.
      System.out.println("Transaction succeeded. Both records were written to the database.");
   }
   catch (SQLException ex) {
      ex.printStackTrace();
      try {
         System.out.println("Transaction failed.");
         con.rollback();
      }
      catch (SQLException se) {
         se.printStackTrace();
      }
   }
}

</pre></span></div></div></div><h1 class="heading">分散トランザクションの使用</h1><div id="sectionSection1" class="section" name="collapseableSection" style=""><p>分散トランザクションは、トランザクション処理の重要な ACID (原子性、一貫性、分離性、および持続性) のプロパティを維持しながら、ネットワーク上の複数のデータベースのデータを更新します。分散トランザクションのサポートは、JDBC 2.0 オプション API 仕様で JDBC API に追加されました。分散トランザクションの管理は、通常、Java EE アプリケーション サーバー環境内で Java Transaction Service (JTS) トランザクション マネージャーによって自動的に実行されます。ただし、Microsoft JDBC Driver for SQL Server は、すべての Java Transaction API (JTA) 準拠のトランザクション マネージャーで分散トランザクションをサポートします。</p><p>JDBC ドライバーは、Microsoft 分散トランザクション コーディネーター (MS DTC) とシームレスに統合することで、SQL Server による真の分散トランザクション サポートを提供します。MS DTC は、Microsoft によって Microsoft Windows システム用に提供される分散トランザクション機能です。MS DTC は、Microsoft の実証済みのトランザクション処理技術を使用して、完全な 2 フェーズ分散コミット プロトコルや分散トランザクションの回復などの XA 機能をサポートします。</p><p>分散トランザクションの使用方法の詳細については、「<span sdata="link"><a href="574e326f-0520-4003-bdf1-62d92c3db457.htm">XA トランザクションについて</a></span>」を参照してください。</p></div><span id="seeAlsoSpan"><h1 class="heading">関連項目</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="afbb776f-05dc-4e79-bb25-2c340483e401.htm">JDBC ドライバーを使用したトランザクションの実行</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">このトピックに関する<a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\dフィードバックありがとうございます。開発チームは、皆様からのフィードバックに基づいてドキュメントを改善しています。フィードバックを確認中、内容の確認または解決策に関するご意見をうかがうために電子メールをお送りする場合があります。お客様の電子メール アドレスをそれ以外の目的で使用することはありません。また、確認完了後はお客様の電子メール アドレス情報を削除させていただきます。%0\Aマイクロソフトのプライバシーに関する声明の詳細については、http://privacy.microsoft.com/ja-jp/default.aspx を参照してください。%0\A%0\d','カスタマー フィードバック');">フィードバック</a>を Microsoft にお送りください。</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft.All rights reserved.</a></p></span></div></div></body></html>