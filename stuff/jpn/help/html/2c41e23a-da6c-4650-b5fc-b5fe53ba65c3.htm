<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>分離レベルについて</title><meta name="Language" content="ja-jp" /><meta name="System.Keywords" content="トランザクション分離レベル" /><meta name="Microsoft.Help.Id" content="2c41e23a-da6c-4650-b5fc-b5fe53ba65c3" /><meta name="Description" content="トランザクションでは分離レベルが指定されます。分離レベルは、あるトランザクションを、他のトランザクションによる (リソースまたはデータの) 変更からどの程度切り離すかを定義するものです。分離レベルは、ダーティ リードやファントム読み取りなど、同時実行の副作用を許可するかどうかという観点で定義されています。" /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">分離レベルについて</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>トランザクションでは分離レベルが指定されます。分離レベルは、あるトランザクションを、他のトランザクションによる (リソースまたはデータの) 変更からどの程度切り離すかを定義するものです。分離レベルは、ダーティ リードやファントム読み取りなど、同時実行の副作用を許可するかどうかという観点で定義されています。</p><p>トランザクション分離レベルでは次の制御を行います。</p><ul><li><p>データの読み取り時にロックを獲得するかどうか、要求されるロックの種類。</p></li><li><p>読み取りロックの保持期間。</p></li><li><p>別のトランザクションによって変更された行を参照している読み取り操作で、次のことを行うかどうか。</p><ul><li><p>その行に対する排他ロックが解放されるまでブロックする。</p></li><li><p>ステートメントまたはトランザクションの開始時に存在していた行の、コミット済みのバージョンを取得する。</p></li><li><p>コミットされていないデータ変更を読み取る。</p></li></ul></li></ul><p>トランザクション分離レベルを選択しても、データ変更を保護するために獲得したロックは影響を受けません。トランザクションでは、設定されたトランザクション分離レベルに関係なく、常に、そのトランザクションで変更するデータについて排他ロックを獲得し、トランザクションが完了するまでそのロックを保持します。トランザクション分離レベルでは主に、読み取り操作に対して、他のトランザクションによって行われる変更の影響からの保護レベルを定義します。</p><p>分離レベルが低いほど多くのユーザーが同時にデータにアクセスできるようになりますが、ユーザーに影響が及ぶ可能性がある同時実行の副作用 (ダーティ リードや更新データの喪失など) の種類が多くなります。反対に、分離レベルが高いほど、ユーザーに影響が及ぶ可能性がある同時実行の副作用の種類は減りますが、必要なシステム リソースが増加し、あるトランザクションによって別のトランザクションがブロックされる状況も多くなります。適切な分離レベルの選択は、アプリケーションのデータ整合性の要件と各分離レベルのオーバーヘッドとのバランスによって決まります。最も高い分離レベルの SERIALIZABLE では、トランザクションが読み取り操作を繰り返し実行した場合、そのトランザクションは毎回まったく同じデータを受け取ります。このことの実現には、マルチユーザー システムにおいて他のユーザーに影響が及ぶ可能性の高いロック レベルが適用されています。最も低い分離レベルは READ UNCOMMITTED ですが、このレベルでは、他のトランザクションによって変更され、まだコミットされていないデータを取得する場合があります。同時実行のあらゆる副作用が READ UNCOMMITTED では生じる可能性がありますが、読み取りロックやバージョニングは発生しないため、オーバーヘッドはごくわずかです。</p></div><h1 class="heading">解説</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>次の表は、分離レベルごとの同時実行の副作用を示しています。</p><div class="tableSection"><table width="50%" cellspacing="2" cellpadding="5" frame="lhs"><tr><th><p>分離レベル</p></th><th><p>ダーティ リード</p></th><th><p>反復不能読み取り</p></th><th><p>ファントム</p></th></tr><tr><td><p>READ UNCOMMITTED</p></td><td><p>可</p></td><td><p>可</p></td><td><p>可</p></td></tr><tr><td><p>READ COMMITTED</p></td><td><p>不可</p></td><td><p>可</p></td><td><p>可</p></td></tr><tr><td><p>REPEATABLE READ</p></td><td><p>不可</p></td><td><p>不可</p></td><td><p>可</p></td></tr><tr><td><p>SNAPSHOT</p></td><td><p>不可</p></td><td><p>不可</p></td><td><p>不可</p></td></tr><tr><td><p>SERIALIZABLE</p></td><td><p>不可</p></td><td><p>不可</p></td><td><p>不可</p></td></tr></table></div><p>2 つのトランザクションが同じ行を取得すると、更新内容の喪失が生じる可能性がありますが、この状況を防ぐためには、REPEATABLE READ 以上の分離レベルでトランザクションを実行し、その後で、元の取得した値に基づいて行を更新する必要があります。2 つのトランザクションが、元の取得した値に基づかずに 1 つの UPDATE ステートメントを使用して行を更新する場合、既定の分離レベル READ COMMITTED では更新データの喪失が発生しません。</p><p>トランザクションの分離レベルを設定するには、<a href="937292a6-1525-423e-a2b2-a18fd34c2893.htm">SQLServerConnection</a> クラスの <a href="6a8fa4d3-5237-40f8-8a02-b40a3d7a1131.htm">setTransactionIsolation</a> メソッドを使用できます。このメソッドは、引数として <span sdata="langKeyword" value="int"><span class="keyword">int</span></span> 値を受け取ります。この値は、次のように接続定数のいずれかに基づいています。</p><div class="sampleCode"><span codeLanguage="other"><pre>con.setTransactionIsolation(Connection.TRANSACTION_READ_COMMITTED);</pre></span></div><p>SQL Server の新しいスナップショット分離レベルを使用するには、次のように <b>SQLServerConnection</b> 定数のいずれかを使用できます。</p><div class="sampleCode"><span codeLanguage="other"><pre>con.setTransactionIsolation(SQLServerConnection.TRANSACTION_SNAPSHOT);</pre></span></div><p>また、次のように使用することもできます。</p><div class="sampleCode"><span codeLanguage="other"><pre>con.setTransactionIsolation(Connection.TRANSACTION_READ_COMMITTED + 4094);</pre></span></div><p>SQL Server の分離レベルの詳細については、SQL Server オンライン ブックの「データベース エンジンにおける分離レベル」を参照してください。</p></div><span id="seeAlsoSpan"><h1 class="heading">関連項目</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="afbb776f-05dc-4e79-bb25-2c340483e401.htm">JDBC ドライバーを使用したトランザクションの実行</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">このトピックに関する<a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\dフィードバックありがとうございます。開発チームは、皆様からのフィードバックに基づいてドキュメントを改善しています。フィードバックを確認中、内容の確認または解決策に関するご意見をうかがうために電子メールをお送りする場合があります。お客様の電子メール アドレスをそれ以外の目的で使用することはありません。また、確認完了後はお客様の電子メール アドレス情報を削除させていただきます。%0\Aマイクロソフトのプライバシーに関する声明の詳細については、http://privacy.microsoft.com/ja-jp/default.aspx を参照してください。%0\A%0\d','カスタマー フィードバック');">フィードバック</a>を Microsoft にお送りください。</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft.All rights reserved.</a></p></span></div></div></body></html>