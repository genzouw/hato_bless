<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>拡張イベント ログの診断情報へのアクセス</title><meta name="Language" content="ja-jp" /><meta name="Microsoft.Help.Id" content="a79e9468-2257-4536-91f1-73b008c376c3" /><meta name="Description" content="Microsoft JDBC Driver 4.0 for SQL Server では、トレース (Tracing Driver Operation) が更新されました。サーバーの接続リング バッファーおよび拡張イベント ログ内のアプリケーション パフォーマンス情報から、接続エラーなどの診断情報にクライアント イベントを関連付けやすくなっています。拡張イベント ログを表示する方法については、「イベント セッション データの表示http://msdn.microsoft." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">拡張イベント ログの診断情報へのアクセス</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>Microsoft JDBC Driver 4.0 for SQL Server では、トレース (<span sdata="link"><a href="723aeae7-6504-4585-ba8b-3525115bea8b.htm">ドライバー操作のトレース</a></span>) が更新されました。サーバーの接続リング バッファーおよび拡張イベント ログ内のアプリケーション パフォーマンス情報から、接続エラーなどの診断情報にクライアント イベントを関連付けやすくなっています。拡張イベント ログを表示する方法については、「<a href="http://msdn.microsoft.com/en-us/library/hh710068(SQL.110).aspx ">イベント セッション データの表示</a>」を参照してください。</p></div><h1 class="heading">詳細</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>接続操作では、Microsoft JDBC Driver for SQL Server によってクライアント接続 ID が送信されます。接続に失敗した場合は、接続リング バッファー (<a href="http://go.microsoft.com/fwlink/?LinkId=207752">接続リング バッファーによる SQL Server 2008 での接続トラブルシューティング</a>) にアクセスし、<span sdata="langKeyword" value="ClientConnectionID"><span class="keyword">ClientConnectionID</span></span> フィールドを見つけて、接続エラーに関する診断情報を取得することができます。クライアント接続 ID は、エラーが発生した場合にのみリング バッファーに記録されます (ログイン前パケットの送信前に接続エラーが発生した場合、クライアント接続 ID は生成されません)。クライアント接続 ID は、16 バイトの GUID です。また、<span sdata="langKeyword" value="client_connection_id"><span class="keyword">client_connection_id</span></span> 操作を拡張イベント セッションのイベントに追加すると、拡張イベントの出力先でクライアント接続 ID を検索することもできます。クライアント ドライバーの詳しい診断サポートが必要な場合は、トレースを有効にして、接続コマンドを再実行し、トレース内の <span sdata="langKeyword" value="ClientConnectionID"><span class="keyword">ClientConnectionID</span></span> フィールドを調べます。</p><p><span sdata="link"><a href="031c01e2-2c65-4fe4-9700-fdbcc7a39f30.htm">ISQLServerConnection インターフェイス</a></span> を使用すると、クライアント接続 ID をプログラムで取得できます。接続 ID は接続関連の例外にも含まれます。</p><p>接続エラーが発生する場合、サーバーの BID トレース情報および接続リング バッファーに含まれるクライアント接続 ID を使用すると、クライアント接続をサーバー上の接続に関連付けることができます。サーバー上の BID トレースの詳細については、「<a href="http://go.microsoft.com/fwlink/?LinkId=125805">SQL Server 2008 でのデータ アクセスのトレース</a>」を参照してください。データ アクセスのトレースに関する記事には、データ アクセスのトレースの実行に関する情報も含まれていますが、これは Microsoft JDBC Driver for SQL Server には当てはまりません。Microsoft JDBC Driver for SQL Server を使用してデータ アクセスのトレースを実行する方法については、「<span sdata="link"><a href="723aeae7-6504-4585-ba8b-3525115bea8b.htm">ドライバー操作のトレース</a></span>」を参照してください。</p><p>JDBC Driver からは、スレッド固有のアクティビティ ID も送信されます。アクティビティ ID は、TRACK_CAUSAILITY オプションを有効にして拡張イベント セッションが開始されている場合、セッション中にキャプチャされます。アクティブな接続に関するパフォーマンスの問題については、クライアントのトレース (ActivityID フィールド) からアクティビティ ID を取得し、このアクティビティ ID を拡張イベント出力で探すことができます。拡張イベント内のアクティビティ ID とは、16 バイトの GUID (クライアント接続 ID の GUID とは異なる) の後に 4 バイトのシーケンス番号が付いたものです。このシーケンス番号は、スレッド内の要求順序を表しています。ActivityId は、SQL バッチ ステートメントおよび RPC 要求用に送信されます。ActivityId をサーバーに送信できるようにするには、まず Logging.Properties ファイル内で次のキー/値ペアを指定する必要があります。</p><div class="sampleCode"><span codeLanguage="other"><pre>com.microsoft.sqlserver.jdbc.traceactivity = on</pre></span></div><p>詳細については、「<span sdata="link"><a href="723aeae7-6504-4585-ba8b-3525115bea8b.htm">ドライバー操作のトレース</a></span>」を参照してください。このトレース フラグは、JDBC Driver で ActivityId をトレースおよび送信するかどうかを決定するために、対応する JDBC オブジェクト ロガーと共に使用されます。Logging.Properties ファイルの更新に加えて、ロガー com.microsoft.sqlserver.jdbc を FINER 以上で有効にする必要があります。特定のクラスによる要求に対してサーバーに ActivityId を送信する場合は、対応するクラス ロガーを FINER または FINEST で有効にする必要があります。たとえば、クラスが SQLServerStatement であれば、ロガー com.microsoft.sqlserver.jdbc.SQLServerStatement を有効にします。</p><p>次のサンプルでは、Transact-SQL を使用して、拡張イベント セッションを開始しています。この拡張イベント セッションはリング バッファーに格納され、RPC 操作およびバッチ操作でクライアントから送信されたアクティビティ ID を記録します。</p><div class="sampleCode"><span codeLanguage="other"><pre>create event session MySession on server
add event connectivity_ring_buffer_recorded,
add event sql_statement_starting (action (client_connection_id)),
add event sql_statement_completed (action (client_connection_id)),
add event rpc_starting (action (client_connection_id)),
add event rpc_completed (action (client_connection_id))
add target ring_buffer with (track_causality=on)</pre></span></div></div><span id="seeAlsoSpan"><h1 class="heading">関連項目</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="723e2680-a0c5-4a7d-a319-1e49e41078cf.htm">JDBC ドライバーで発生した問題の診断</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">このトピックに関する<a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\dフィードバックありがとうございます。開発チームは、皆様からのフィードバックに基づいてドキュメントを改善しています。フィードバックを確認中、内容の確認または解決策に関するご意見をうかがうために電子メールをお送りする場合があります。お客様の電子メール アドレスをそれ以外の目的で使用することはありません。また、確認完了後はお客様の電子メール アドレス情報を削除させていただきます。%0\Aマイクロソフトのプライバシーに関する声明の詳細については、http://privacy.microsoft.com/ja-jp/default.aspx を参照してください。%0\A%0\d','カスタマー フィードバック');">フィードバック</a>を Microsoft にお送りください。</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft.All rights reserved.</a></p></span></div></div></body></html>