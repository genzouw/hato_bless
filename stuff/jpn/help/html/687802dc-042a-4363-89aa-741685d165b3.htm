<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>Kerberos 統合認証による SQL Server への接続</title><meta name="Language" content="ja-jp" /><meta name="Microsoft.Help.Id" content="687802dc-042a-4363-89aa-741685d165b3" /><meta name="Description" content="Microsoft JDBC Driver 4." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">Kerberos 統合認証による SQL Server への接続</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>Microsoft JDBC Driver 4.0 for SQL Server 以降、アプリケーションは、<span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> 接続プロパティを使用して、タイプ 4 の Kerberos 統合認証を使用してデータベースに接続することを示すことができます。接続プロパティの詳細については、「<span sdata="link"><a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">接続プロパティの設定</a></span>」を参照してください。Kerberos の詳細については、「<a href="http://go.microsoft.com/fwlink/?LinkId=101449">Windows を対象とした Kerberos に関する技術的補足</a>」および「<a href="http://go.microsoft.com/fwlink/?LinkID=100758">Microsoft Kerberos</a>」を参照してください。</p><p>Java <span sdata="langKeyword" value="Krb5LoginModule"><span class="keyword">Krb5LoginModule</span></span> で統合認証を使用する場合、<a href="http://download.oracle.com/javase/1.5.0/docs/guide/security/jaas/spec/com/sun/security/auth/module/Krb5LoginModule.html">クラス Krb5LoginModule</a> を使用してモジュールを構成できます。</p><p>Microsoft JDBC Driver for SQL Server では、IBM Java VM 用に次のプロパティが設定されます。</p><ul><li><p><span sdata="langKeyword" value="useDefaultCcache = true"><span class="keyword">useDefaultCcache = true</span></span></p></li><li><p><span sdata="langKeyword" value="moduleBanner = false"><span class="keyword">moduleBanner = false</span></span></p></li></ul><p>Microsoft JDBC Driver for SQL Server では、他のすべての Java VM 用に次のプロパティが設定されます。</p><ul><li><p><span sdata="langKeyword" value="useTicketCache = true"><span class="keyword">useTicketCache = true</span></span></p></li><li><p><span sdata="langKeyword" value="doNotPrompt = true"><span class="keyword">doNotPrompt = true</span></span></p></li></ul></div><h1 class="heading">解説</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>Microsoft JDBC Driver 4.0 for SQL Server より前、アプリケーションは、「<span sdata="link"><a href="44996746-d373-4f59-9863-a8a20bb8024a.htm">接続 URL の構築</a></span>」に示されているように、<span sdata="langKeyword" value="integratedSecurity"><span class="keyword">integratedSecurity</span></span> 接続プロパティを使用し、<span sdata="langKeyword" value="sqljdbc_auth.dll"><span class="keyword">sqljdbc_auth.dll</span></span> を参照することによって、(使用可能性に基づいて Kerberos または NTLM を使用する) 統合認証を指定できました。</p><p>Microsoft JDBC Driver 4.0 for SQL Server 以降、アプリケーションは、<span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> 接続プロパティを使用して、ピュア Java Kerberos 実装を使用した Kerberos 統合認証を使用してデータベースに接続することを示すことができます。</p><ul><li><p><span sdata="langKeyword" value="Krb5LoginModule"><span class="keyword">Krb5LoginModule</span></span> による統合認証を使用するには、依然として <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span> 接続プロパティを指定する必要があります。さらに、<span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span> 接続プロパティを指定します。</p></li><li><p><span sdata="langKeyword" value="sqljdbc_auth.dll"><span class="keyword">sqljdbc_auth.dll</span></span> による統合認証の使用を続行するには、依然として <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span> 接続プロパティのみ (オプションで <span sdata="langKeyword" value="authenticationScheme=NativeAuthentication"><span class="keyword">authenticationScheme=NativeAuthentication</span></span>) を指定します。</p></li><li><p><span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span> を指定する一方で <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span> を指定しない場合、ドライバーは <span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> 接続プロパティを無視し、ユーザー名およびパスワード資格情報が接続文字列に含まれていると見なします。</p></li></ul><p>データソースを使用して接続を作成する場合、<a href="b942f78e-7ce1-44ef-923d-a7c3d7c76b83.htm">setAuthenticationScheme</a> を使用して認証スキームをプログラムで設定できます。</p><p>Kerberos 認証をサポートするために、新しいロガー com.microsoft.sqlserver.jdbc.internals.KerbAuthentication が追加されました。詳細については、「<span sdata="link"><a href="723aeae7-6504-4585-ba8b-3525115bea8b.htm">ドライバー操作のトレース</a></span>」を参照してください。</p><p>Kerberos を構成する場合は、次のガイドラインに従ってください。</p><ol><li><p>Windows レジストリの <span sdata="langKeyword" value="AllowTgtSessionKey"><span class="keyword">AllowTgtSessionKey</span></span> を 1 に設定してください。詳細については、「<a href="http://support.microsoft.com/kb/837361">Windows Server 2003 における Kerberos プロトコルのレジストリ エントリおよび KDC 構成キー</a>」を参照してください。</p></li><li><p>Kerberos 構成 (UNIX 環境の krb5.conf) で環境の適切な領域および KDC が指定されていることを確認します。</p></li><li><p>kinit を使用するかまたはドメインにログインして、TGT キャッシュを初期化します。</p></li><li><p><span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span> を使用するアプリケーションを Windows Vista または Windows 7 オペレーティング システムで実行する場合は、標準ユーザー アカウントを使用する必要があります。ただし、管理者のアカウントでアプリケーションを実行する場合は、アプリケーションを管理者権限で実行する必要があります。</p></li></ol></div><h1 class="heading">サービス プリンシパル名</h1><div id="sectionSection1" class="section" name="collapseableSection" style=""><p>サービス プリンシパル名 (SPN) は、クライアントがサービスのインスタンスを一意に識別するための名前です。サービス プリンシパル名 (SPN) の詳細については、以下を参照してください。</p><ul><li><p><a href="http://support.microsoft.com/kb/319723">SQL Server で Kerberos 認証を使用する方法</a></p></li><li><p><a href="http://go.microsoft.com/fwlink/?LinkId=207814">SQL Server での Kerberos の使用</a></p></li></ul></div><h1 class="heading">ログイン モジュール構成ファイルの作成</h1><div id="sectionSection2" class="section" name="collapseableSection" style=""><p>オプションで Kerberos 構成ファイルを指定できます。構成ファイルを指定しない場合、次の設定が有効になります。</p><dl class="authored"><dt>Sun JVM</dt><dd><p>com.sun.security.auth.module.Krb5LoginModule required useTicketCache=true doNotPrompt=true;</p></dd><dt>IBM JVM</dt><dd><p>com.ibm.security.auth.module.Krb5LoginModule required useDefaultCcache = true moduleBanner = false;</p></dd></dl><p>ログイン モジュール構成ファイルを作成する場合は、次の形式に従ってファイルを作成する必要があります。</p><div class="sampleCode"><span codeLanguage="other"><pre>&lt;<i>name</i>&gt; {
    &lt;<i>LoginModule</i>&gt; &lt;<i>flag</i>&gt; &lt;<i>LoginModule options</i>&gt;;
    &lt;<i>optional_additional_LoginModules</i>, <i>flags_and_options</i>&gt;;
};</pre></span></div><p>ログイン構成ファイルは、特定の 1 つまたは複数のアプリケーションに使用する基底の認証テクノロジを指定する 1 つ以上のエントリから構成されます。次に例を示します。</p><div class="sampleCode"><span codeLanguage="other"><pre>SQLJDBCDriver {
   com.sun.security.auth.module.Krb5LoginModule required useTicketCache=true doNotPrompt=true;
};</pre></span></div><p>このように、それぞれのログイン モジュール構成ファイル エントリは、名前と、それに続く、(それぞれがセミコロンで終了し、グループ全体が中かっこで囲まれた) 1 つまたは複数のログイン モジュール固有のエントリから構成されます。それぞれの構成ファイル エントリはセミコロンで終了します。</p><p>ドライバーは、ログイン モジュール構成ファイルに指定された設定を使用して Kerberos 資格情報を取得できることに加え、既存の資格情報を使用できます。この機能は、アプリケーションでユーザーの資格情報を複数使用して接続を作成する必要がある場合に便利です。</p><p>ドライバーは、指定されたログイン モジュールを使用してログインを試行する前に、既存の資格情報を使用できる場合はそれを使用します。したがって、特定のコンテキストで Subject.doAs メソッドを使用してコードを実行した場合、Subject.doAs 呼び出しに渡された資格情報を使用して接続が作成されます。</p><p>詳細については、「<a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/tutorials/LoginConfigFile.html">JAAS ログイン構成ファイル</a>」および「<a href="http://download.oracle.com/javase/1.5.0/docs/guide/security/jgss/tutorials/KerberosReq.html">クラス Krb5LoginModule</a>」を参照してください。</p></div><h1 class="heading">Kerberos 構成ファイルの作成</h1><div id="sectionSection3" class="section" name="collapseableSection" style=""><p>Kerberos 構成ファイルの詳細については、「<a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/tutorials/LoginConfigFile.html">Kerberos の要件</a>」を参照してください。</p><p>サンプル ドメイン構成ファイルの例を次に示します。ここで、YYYY および ZZZZ は、サイトのドメイン名です。</p><div class="sampleCode"><span codeLanguage="other"><pre>[libdefaults]
default_realm = YYYY.CORP.CONTOSO.COM
dns_lookup_realm = false
dns_lookup_kdc = true
ticket_lifetime = 24h
forwardable = yes

[domain_realm]
.yyyy.corp.contoso.com = YYYY.CORP.CONTOSO.COM
.zzzz.corp.contoso.com = ZZZZ.CORP.CONTOSO.COM

[realms]
        YYYY.CORP.CONTOSO.COM = {
  kdc = krbtgt/YYYY.CORP. CONTOSO.COM @ YYYY.CORP. CONTOSO.COM
  default_domain = YYYY.CORP. CONTOSO.COM
}

        ZZZZ.CORP. CONTOSO.COM = {
  kdc = krbtgt/ZZZZ.CORP. CONTOSO.COM @ ZZZZ.CORP. CONTOSO.COM
  default_domain = ZZZZ.CORP. CONTOSO.COM
}
</pre></span></div></div><h1 class="heading">ドメイン構成ファイルおよびログイン モジュール構成ファイルの有効化</h1><div id="sectionSection4" class="section" name="collapseableSection" style=""><p>ドメイン構成ファイルを有効にするには、-Djava.security.krb5.conf を使用します。ログイン モジュール構成ファイルを有効にするには、<span sdata="langKeyword" value="-Djava.security.auth.login.config"><span class="keyword">-Djava.security.auth.login.config</span></span> を使用します。</p><p>たとえば、アプリケーションを起動するときに、次のコマンド ラインを使用できます。</p><div class="sampleCode"><span codeLanguage="other"><pre>Java.exe -Djava.security.auth.login.config=SQLJDBCDriver.conf -Djava.security.krb5.conf=krb5.ini &lt;<i>APPLICATION_NAME</i>&gt;
</pre></span></div></div><h1 class="heading">Kerberos を介して SQL Server にアクセスできるかどうかの確認</h1><div id="sectionSection5" class="section" name="collapseableSection" style=""><p>SQL Server Management Studio で次のクエリを実行します。</p><p><span sdata="langKeyword" value="select auth_scheme from sys.dm_exec_connections where session_id=@@spid"><span class="keyword">select auth_scheme from sys.dm_exec_connections where session_id=@@spid</span></span></p><p>このクエリを実行するために必要な権限があることを確認してください。</p></div><span id="seeAlsoSpan"><h1 class="heading">関連項目</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="94bcfbe3-f00e-4774-bda8-bb7577518fec.htm">JDBC ドライバーによる SQL Server への接続</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">このトピックに関する<a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\dフィードバックありがとうございます。開発チームは、皆様からのフィードバックに基づいてドキュメントを改善しています。フィードバックを確認中、内容の確認または解決策に関するご意見をうかがうために電子メールをお送りする場合があります。お客様の電子メール アドレスをそれ以外の目的で使用することはありません。また、確認完了後はお客様の電子メール アドレス情報を削除させていただきます。%0\Aマイクロソフトのプライバシーに関する声明の詳細については、http://privacy.microsoft.com/ja-jp/default.aspx を参照してください。%0\A%0\d','カスタマー フィードバック');">フィードバック</a>を Microsoft にお送りください。</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft.All rights reserved.</a></p></span></div></div></body></html>